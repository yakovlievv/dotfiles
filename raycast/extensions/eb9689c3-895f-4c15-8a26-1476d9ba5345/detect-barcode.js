"use strict";var f=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var s in t)f(e,s,{get:t[s],enumerable:!0})},k=(e,t,s,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of B(t))!C.call(e,a)&&a!==s&&f(e,a,{get:()=>t[a],enumerable:!(c=F(t,a))||c.enumerable});return e};var U=e=>k(f({},"__esModule",{value:!0}),e);var J={};R(J,{default:()=>z});module.exports=U(J);var p=require("@raycast/api");var h=require("@raycast/api"),y=require("path"),S=require("fs/promises"),T=require("child_process");async function E(e,...t){if(process.platform==="win32")return Promise.reject(new Error("Swift functions are not supported on Windows"));let s=(0,y.join)(h.environment.assetsPath,"compiled_raycast_swift/swift");return await(0,S.chmod)(s,"755"),new Promise((c,a)=>{let w=[e];for(let n of t)try{w.push(JSON.stringify(n,(r,i)=>i===void 0?null:i))}catch(r){a(new u("Failed to serialize input to JSON: "+r.message));return}let d=(0,T.spawn)(s,w),l=[],g=[];d.stdout?.on("data",n=>{l.push(n.toString())}),d.stderr?.on("data",n=>{g.push(n.toString())}),d.on("exit",n=>{if(n===0)try{let r=l.join("").trim();r.length!=0?c(JSON.parse(r)):c(null)}catch(r){let i=new u("Failed to deserialize result from JSON: "+r.message);i.stdout=l.join("").trim(),i.stderr=g.join("").trim(),a(i)}else{let r=new u(g.join("").trim()||l.join("").trim()||"Could not get any data");r.stdout=l.join("").trim(),r.stderr=g.join("").trim(),a(r)}}),d.on("error",n=>{a(n)})})}async function x(e,t){return await E("detectBarcode",e,t)}var u=class extends Error{constructor(t){super(t),this.name="SwiftError"}};var L=require("@raycast/api");var o=require("@raycast/api");var v=async()=>{let e=(0,o.getPreferenceValues)();try{return await x(e.keepImage,!!e.playSound)}catch(t){throw console.error(t),new Error("Failed to detect barcode")}},P=async e=>{(0,o.getPreferenceValues)().showToast&&await(0,o.showToast)({style:o.Toast.Style.Success,title:e})},m=async e=>{(0,o.getPreferenceValues)().showToast&&await(0,o.showToast)({style:o.Toast.Style.Failure,title:e})};async function z(){await(0,p.closeMainWindow)();try{let e=await v();if(!e||e==="No barcodes or QR codes detected"){await m("No barcodes or QR codes detected");return}await p.Clipboard.copy(e),await P("Copied barcode/QR code to clipboard")}catch(e){console.error(e),await m("Failed detecting barcode/QR code")}}
