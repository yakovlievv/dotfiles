"use strict";var L=Object.create;var b=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var V=(e,t)=>{for(var n in t)b(e,n,{get:t[n],enumerable:!0})},x=(e,t,n,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of M(t))!D.call(e,s)&&s!==n&&b(e,s,{get:()=>t[s],enumerable:!(c=z(t,s))||c.enumerable});return e};var w=(e,t,n)=>(n=e!=null?L(W(e)):{},x(t||!e||!e.__esModule?b(n,"default",{value:e,enumerable:!0}):n,e)),N=e=>x(b({},"__esModule",{value:!0}),e);var j={};V(j,{default:()=>O});module.exports=N(j);var y=require("@raycast/api");var v=require("@raycast/api"),S=require("path"),E=require("fs/promises"),R=require("child_process");async function F(e,...t){if(process.platform==="win32")return Promise.reject(new Error("Swift functions are not supported on Windows"));let n=(0,S.join)(v.environment.assetsPath,"compiled_raycast_swift","swift");return await(0,E.chmod)(n,"755"),new Promise((c,s)=>{let h=[e];for(let o of t)try{h.push(JSON.stringify(o,(i,d)=>d===void 0?null:d))}catch(i){s(new m("Failed to serialize input to JSON: "+i.message));return}let a=(0,R.spawn)(n,h),p=[],g=[];a.stdout?.on("data",o=>{p.push(o.toString())}),a.stderr?.on("data",o=>{g.push(o.toString())}),a.on("exit",o=>{if(o===0)try{let i=p.join("").trim();i.length!=0?c(JSON.parse(i)):c(null)}catch(i){let d=new m("Failed to deserialize result from JSON: "+i.message);d.stdout=p.join("").trim(),d.stderr=g.join("").trim(),s(d)}else{let i=new m(g.join("").trim()||p.join("").trim()||"Could not get any data");i.stdout=p.join("").trim(),i.stderr=g.join("").trim(),s(i)}}),a.on("error",o=>{s(o)})})}async function T(e,t){return await F("detectBarcode",e,t)}var m=class extends Error{constructor(t){super(t),this.name="SwiftError"}};var A=require("@raycast/api");var l=require("@raycast/api");var u=w(require("react")),r=require("@raycast/api");var f=w(require("node:fs")),$=w(require("node:path"));var U=require("react/jsx-runtime");function _(e,t){let n=e instanceof Error?e.message:String(e);return(0,r.showToast)({style:r.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??n,primaryAction:t?.primaryAction??P(e),secondaryAction:t?.primaryAction?P(e):void 0})}var P=e=>{let t=!0,n="[Extension Name]...",c="";try{let a=JSON.parse((0,f.readFileSync)((0,$.join)(r.environment.assetsPath,"..","package.json"),"utf8"));n=`[${a.title}]...`,c=`https://raycast.com/${a.owner||a.author}/${a.name}`,(!a.owner||a.access==="public")&&(t=!1)}catch{}let s=r.environment.isDevelopment||t,h=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:s?"Copy Logs":"Report Error",onAction(a){a.hide(),s?r.Clipboard.copy(h):(0,r.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(n)}&extension-url=${encodeURI(c)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${h}
\`\`\`
`)}`)}}};var C=async()=>{let e=(0,l.getPreferenceValues)();try{return await T(e.keepImage,!!e.playSound)}catch(t){throw console.error(t),new Error("Failed to detect barcode")}},I=async e=>{(0,l.getPreferenceValues)().showToast&&await(0,l.showToast)({style:l.Toast.Style.Success,title:e})},k=async(e,t)=>{(0,l.getPreferenceValues)().showToast&&await _(e,t)};async function O(){await(0,y.closeMainWindow)();try{let e=await C();if(!e||e==="No barcodes or QR codes detected"){await k("No barcodes or QR codes detected",{title:"No barcodes or QR codes detected"});return}await y.Clipboard.copy(e),await I("Copied barcode/QR code to clipboard")}catch(e){console.error(e),await k(e,{title:"Failed detecting barcode/QR code"})}}
